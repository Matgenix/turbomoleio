

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>turbomoleio.input.tests.test_define &mdash; turbomoleio 1.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> turbomoleio
          

          
          </a>

          
            
            
              <div class="version">
                1.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../datagroups.html">The data group files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../coord.html">The coord file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../definerunner.html">Running define</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../output_parsing.html">Outputs parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendix.html">Appendix</a></li>
</ul>
<p><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/introduction.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/parsing_logs.html">Output logs parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/definerunner.html">Define runner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/versioning.html#backward-compatibility">Backward-compatibility</a></li>
</ul>
<p><span class="caption-text">Additional information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bugs.html">Reporting bugs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">turbomoleio</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>turbomoleio.input.tests.test_define</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for turbomoleio.input.tests.test_define</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># The turbomoleio package, a python interface to Turbomole</span>
<span class="c1"># for preparing inputs, parsing outputs and other related tools.</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2018-2021 BASF SE, Matgenix SRL.</span>
<span class="c1">#</span>
<span class="c1"># This file is part of turbomoleio.</span>
<span class="c1">#</span>
<span class="c1"># Turbomoleio is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># Turbomoleio is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with turbomoleio (see ~turbomoleio/COPYING). If not,</span>
<span class="c1"># see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pexpect</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pexpect.popen_spawn</span> <span class="kn">import</span> <span class="n">PopenSpawn</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">mock</span>
<span class="kn">from</span> <span class="nn">monty.os</span> <span class="kn">import</span> <span class="n">makedirs_p</span>
<span class="kn">from</span> <span class="nn">monty.collections</span> <span class="kn">import</span> <span class="n">dict2namedtuple</span>

<span class="kn">from</span> <span class="nn">turbomoleio.testfiles.utils</span> <span class="kn">import</span> <span class="n">temp_dir</span><span class="p">,</span> <span class="n">touch_file</span>
<span class="kn">from</span> <span class="nn">turbomoleio.input.define</span> <span class="kn">import</span> <span class="n">DefineError</span><span class="p">,</span> <span class="n">DefineParameterError</span><span class="p">,</span> <span class="n">DefineExpectError</span><span class="p">,</span> <span class="n">UnsupportedDefineStateError</span>
<span class="kn">from</span> <span class="nn">turbomoleio.input.define</span> <span class="kn">import</span> <span class="n">DefineIredError</span>
<span class="kn">from</span> <span class="nn">turbomoleio.input.define</span> <span class="kn">import</span> <span class="n">DefineRunner</span>
<span class="kn">from</span> <span class="nn">turbomoleio.core.control</span> <span class="kn">import</span> <span class="n">Control</span>


<div class="viewcode-block" id="TestExceptions"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestExceptions">[docs]</a><span class="k">class</span> <span class="nc">TestExceptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests the Define specific exceptions</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestExceptions.test_create"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestExceptions.test_create">[docs]</a>    <span class="k">def</span> <span class="nf">test_create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">de</span> <span class="o">=</span> <span class="n">DefineError</span><span class="p">(</span><span class="s2">&quot;test error&quot;</span><span class="p">)</span>
        <span class="n">dpe</span> <span class="o">=</span> <span class="n">DefineParameterError</span><span class="p">(</span><span class="s2">&quot;test error&quot;</span><span class="p">)</span>
        <span class="n">die</span> <span class="o">=</span> <span class="n">DefineIredError</span><span class="p">(</span><span class="s2">&quot;test error&quot;</span><span class="p">)</span>
        <span class="n">dee</span> <span class="o">=</span> <span class="n">DefineExpectError</span><span class="p">(</span><span class="s2">&quot;test error&quot;</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pattern1&quot;</span><span class="p">,</span> <span class="s2">&quot;pattern2&quot;</span><span class="p">])</span>
        <span class="n">udse</span> <span class="o">=</span> <span class="n">UnsupportedDefineStateError</span><span class="p">(</span><span class="s2">&quot;test error&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="dr_data"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.dr_data">[docs]</a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;use_popen&quot;</span><span class="p">,</span> <span class="s2">&quot;use_pty&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dr_data</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">use_popen</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">param</span>

    <span class="n">dr</span> <span class="o">=</span> <span class="n">DefineRunner</span><span class="p">({},</span> <span class="n">use_popen</span><span class="o">=</span><span class="n">use_popen</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_popen</span><span class="p">:</span>
        <span class="n">spawn_class</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">popen_spawn</span><span class="o">.</span><span class="n">PopenSpawn</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">define</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">pexpect</span><span class="o">.</span><span class="n">popen_spawn</span><span class="o">.</span><span class="n">PopenSpawn</span><span class="p">)</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spawn_class</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">define</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">pexpect</span><span class="o">.</span><span class="n">spawn</span><span class="p">)</span>

    <span class="n">expect_mock</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">expect</span>
    <span class="n">sendline_mock</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">sendline</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">dict2namedtuple</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">use_popen</span><span class="o">=</span><span class="n">use_popen</span><span class="p">,</span> <span class="n">dr</span><span class="o">=</span><span class="n">dr</span><span class="p">,</span> <span class="n">expect_mock</span><span class="o">=</span><span class="n">expect_mock</span><span class="p">,</span>
                                <span class="n">sendline_mock</span><span class="o">=</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">spawn_class</span><span class="o">=</span><span class="n">spawn_class</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">data</span></div>


<span class="c1"># unrealistic example of output from the state selection menu.</span>
<span class="c1"># designed to trigger the different ifs and exceptions in the code</span>
<span class="n">str_state_selection_menu</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot;STATE SELECTION MENU</span>

<span class="s2"> IRREP |  #STATES  | #SELECTED |</span>
<span class="s2"> ----------------------------------------------------------------</span>
<span class="s2">  a1   |       24  |        0  | z xx+yy+zz</span>
<span class="s2">  a2   |        9  |        0  | Lz</span>
<span class="s2">  b1   |       19  |        0  | x Ly xz</span>
<span class="s2">  b2   |       13  |        0  | y Lx yz</span>
<span class="s2">  a    |    22923  |        0  | x y z Lx Ly Lz 1.85xx+1.85yy+zz</span>
<span class="s2">       |           |           | xz yz</span>

<span class="s2"> SELECT IRREP AND NUMBER OF STATES</span>
<span class="s2"> ENTER ? FOR HELP, * OR Q TO QUIT, &amp; TO GO BACK</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">match_ex_state_selection</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*SELECT IRREP AND NUMBER OF STATES&quot;</span><span class="p">,</span> <span class="n">str_state_selection_menu</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_u_off</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot; MAIN MENU FOR RESPONSE CALCULATIONS</span>

<span class="s2"> OPTION | STATUS | DESCRIPTION</span>
<span class="s2"> -------------------------------------------------------------------</span>
<span class="s2"> urpa   | off    | SPIN-UNRESTRICTED RPA EXCITATIONS (TDHF OR TDDFT)</span>
<span class="s2"> ucis   | off    | SPIN-UNRESTRICTED TDA EXCITATIONS (CI SINGLES)</span>
<span class="s2"> polly  | off    | STATIC POLARIZABILITY</span>
<span class="s2"> dynpol | off    | DYNAMIC POLARIZABILITY</span>

<span class="s2"> ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION, * OR q TO QUIT</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">match_ex_response_u_off</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_u_off</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_urpa_on</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">str_response_menu_u_off</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;urpa   | off&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;urpa   | on &quot;</span><span class="p">)</span>

<span class="n">match_ex_response_urpa_on</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_urpa_on</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_ucis_on</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">str_response_menu_u_off</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;ucis   | off&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;ucis   | on &quot;</span><span class="p">)</span>

<span class="n">match_ex_response_ucis_on</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_ucis_on</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_st_off</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot; MAIN MENU FOR RESPONSE CALCULATIONS</span>

<span class="s2"> OPTION | STATUS | DESCRIPTION</span>
<span class="s2"> -------------------------------------------------------------------</span>
<span class="s2"> rpas   | off    | RPA SINGLET EXCITATIONS (TDHF OR TDDFT)</span>
<span class="s2"> ciss   | off    | TDA SINGLET EXCITATIONS (CI SINGLES)</span>
<span class="s2"> rpat   | off    | RPA TRIPLET EXCITATIONS (TDHF OR TDDFT)</span>
<span class="s2"> cist   | off    | TDA TRIPLET EXCITATIONS (CI SINGLES)</span>
<span class="s2"> polly  | off    | STATIC POLARIZABILITY</span>
<span class="s2"> dynpol | off    | DYNAMIC POLARIZABILITY</span>
<span class="s2"> single | off    | SINGLET STABILITY ANALYSIS</span>
<span class="s2"> triple | off    | TRIPLET STABILITY ANALYSIS</span>
<span class="s2"> nonrel | off    | NON-REAL STABILITY ANALYSIS</span>

<span class="s2"> ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION, * OR q TO QUIT</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">match_ex_response_st_off</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_st_off</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_rpas_on</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">str_response_menu_st_off</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;rpas   | off&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;rpas   | on &quot;</span><span class="p">)</span>

<span class="n">match_ex_response_rpas_on</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_rpas_on</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_polly_on</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">str_response_menu_st_off</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;polly  | off&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;polly  | on &quot;</span><span class="p">)</span>

<span class="n">match_ex_response_polly_on</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_polly_on</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

<span class="n">str_response_menu_wrong</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot; MAIN MENU FOR RESPONSE CALCULATIONS</span>

<span class="s2"> OPTION | STATUS | DESCRIPTION</span>
<span class="s2"> -------------------------------------------------------------------</span>
<span class="s2"> polly  | off    | STATIC POLARIZABILITY</span>
<span class="s2"> dynpol | off    | DYNAMIC POLARIZABILITY</span>

<span class="s2"> ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION, * OR q TO QUIT</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">match_ex_response_wrong</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;----.*ENTER &lt;OPTION&gt; TO SWITCH ON/OFF OPTION&quot;</span><span class="p">,</span> <span class="n">str_response_menu_wrong</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>


<div class="viewcode-block" id="TestDefineRunner"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner">[docs]</a><span class="k">class</span> <span class="nc">TestDefineRunner</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unit tests for DefineRunner. Mainly based on mocking.</span>
<span class="sd">    All methods are tested separately mocking the define and expect command</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestDefineRunner.assert_sendline_calls"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.assert_sendline_calls">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">assert_sendline_calls</span><span class="p">(</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">calls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the calls to sendline were performed and no else.</span>
<span class="sd">        All the calls and the order should match exactly.</span>

<span class="sd">        Args:</span>
<span class="sd">            sendline_mock: the Mock object for sendline</span>
<span class="sd">            calls: a list of strings with the expected calls to sendline</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">sendline_mock</span><span class="o">.</span><span class="n">mock_calls</span> <span class="o">==</span> <span class="p">[</span><span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">]</span></div>

<div class="viewcode-block" id="TestDefineRunner.assert_sendline_has_calls"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.assert_sendline_has_calls">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">assert_sendline_has_calls</span><span class="p">(</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">calls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if at least these calls to sendline were performed. Other calls</span>
<span class="sd">        may have been done, but this will not be checked.</span>
<span class="sd">        Based on mock method &#39;assert_has_calls&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            sendline_mock: the Mock object for sendline</span>
<span class="sd">            calls: a list of strings with the expected calls to sendline</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sendline_mock</span><span class="o">.</span><span class="n">assert_has_calls</span><span class="p">([</span><span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">],</span> <span class="n">any_order</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_init"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_init">[docs]</a>    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">DefineRunner</span><span class="p">({},</span> <span class="n">use_popen</span><span class="o">=</span><span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">==</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">spawn_class</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_is_alive"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_is_alive">[docs]</a>    <span class="k">def</span> <span class="nf">test_is_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_is_alive</span>

        <span class="c1"># the called function depends on use_popen. Need to distinguish</span>
        <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
            <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">isalive</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_close"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_close">[docs]</a>    <span class="k">def</span> <span class="nf">test_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">define</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">Mock</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">spawn_class</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;turbomoleio.input.define.DefineRunner._is_alive&quot;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">)</span> <span class="k">as</span> <span class="n">is_alive</span><span class="p">:</span>
            <span class="n">is_alive</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dr</span><span class="o">.</span><span class="n">_close</span><span class="p">()</span>

            <span class="c1"># the called function depends on use_popen. Need to distinguish</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">kill</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_expect"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_expect">[docs]</a>    <span class="k">def</span> <span class="nf">test_expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">case</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_expect</span><span class="p">([</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;test action&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">case</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;Expect&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;Action&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;test action&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">([</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_expect_raise_timeout"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_expect_raise_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">test_expect_raise_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;turbomoleio.input.define.DefineRunner._is_alive&quot;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">)</span> <span class="k">as</span> <span class="n">is_alive</span><span class="p">:</span>
            <span class="n">is_alive</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineExpectError</span><span class="p">):</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_expect</span><span class="p">([</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;test action&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_expect_raise_eof"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_expect_raise_eof">[docs]</a>    <span class="k">def</span> <span class="nf">test_expect_raise_eof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="n">pexpect</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">EOF</span><span class="p">(</span><span class="s2">&quot;eof&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">mock</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;turbomoleio.input.define.DefineRunner._is_alive&quot;</span><span class="p">,</span> <span class="n">new_callable</span><span class="o">=</span><span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">)</span> <span class="k">as</span> <span class="n">is_alive</span><span class="p">:</span>
            <span class="n">is_alive</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineExpectError</span><span class="p">):</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_expect</span><span class="p">([</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;test action&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_sendline"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_sendline">[docs]</a>    <span class="k">def</span> <span class="nf">test_sendline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_sendline</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;test action&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="s2">&quot;Sendline&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;Action&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;command&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="k">assert</span> <span class="s2">&quot;test action&quot;</span> <span class="ow">in</span> <span class="n">message</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_full_1"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_full_1">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_run_full_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">other_control</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;control2&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="n">other_control</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">,</span> <span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="n">other_control</span><span class="p">,</span>
                                     <span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="s2">&quot;use_cosmo&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># mock these functions to not having failures due to case == 0</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_define_symmetry</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_add_cosmo</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">,</span> <span class="n">match_ex_state_selection</span><span class="p">]</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>

            <span class="c1">#create an empty control file for the postprocess</span>
            <span class="n">Control</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span><span class="o">.</span><span class="n">to_file</span><span class="p">()</span>

            <span class="k">assert</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_full</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_full_2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_full_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_run_full_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">,</span> <span class="n">match_ex_state_selection</span><span class="p">]</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="c1"># set poll to None so that kill is called and cover all cases</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># create an empty control file for the postprocess</span>
            <span class="n">Control</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span><span class="o">.</span><span class="n">to_file</span><span class="p">()</span>

            <span class="k">assert</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_full</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">kill</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_update_internal_coords"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_update_internal_coords">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_run_update_internal_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="c1"># set poll to None so that kill is called and cover all cases</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_update_internal_coords</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_has_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sy c3v &quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;qq&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">kill</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_update_internal_coords_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_update_internal_coords_error">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_run_update_internal_coords_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="c1"># set poll to None so that kill is called and cover all cases</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineIredError</span><span class="p">):</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_update_internal_coords</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_generate_mo_files"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_generate_mo_files">[docs]</a>    <span class="k">def</span> <span class="nf">test_run_generate_mo_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="c1"># set poll to None so that kill is called and cover all cases</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_generate_mo_files</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;eht&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;qq&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">kill</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_run_generate_mo_files_sym"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_run_generate_mo_files_sym">[docs]</a>    <span class="k">def</span> <span class="nf">test_run_generate_mo_files_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="c1"># use control here just to let the test pass</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sym&quot;</span><span class="p">:</span> <span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="s2">&quot;control&quot;</span><span class="p">}</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_spawn</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="c1"># set poll to None so that kill is called and cover all cases</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">run_generate_mo_files</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;sy c1 &quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;use control&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;qq&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">use_popen</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">kill</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGKILL</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_get_bin_path"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_get_bin_path">[docs]</a>    <span class="k">def</span> <span class="nf">test_get_bin_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_get_bin_path</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;define&quot;</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_metric"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_metric">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="c1"># first create the control with the specified metric</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">assert</span> <span class="s2">&quot;metric 2&quot;</span> <span class="ow">in</span> <span class="n">s</span>

            <span class="c1"># now modify the existing one</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metric&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_metric</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">assert</span> <span class="s2">&quot;metric 1&quot;</span> <span class="ow">in</span> <span class="n">s</span>
                <span class="k">assert</span> <span class="s2">&quot;2&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_initialize_control_incompatibility"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_initialize_control_incompatibility">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_control_incompatibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_initialize_control</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_initialize_control_1"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_initialize_control_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_control_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_initialize_control</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_initialize_control_2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_initialize_control_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_initialize_control_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;test title&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_initialize_control</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;test title&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_new_coords_1"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_new_coords_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_new_coords_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a coord&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;desy&quot;</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_new_coords_2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_new_coords_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_new_coords_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;desy_eps&quot;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a coord&quot;</span><span class="p">,</span> <span class="s2">&quot;desy 0.0001&quot;</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_new_coords_3"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_new_coords_3">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_new_coords_3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="c1"># here desy will be ignored</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;sym&quot;</span><span class="p">:</span> <span class="s2">&quot;c2v&quot;</span><span class="p">,</span> <span class="s2">&quot;sym_eps&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a coord&quot;</span><span class="p">,</span> <span class="s2">&quot;sy c2v 0.01&quot;</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_no_new_coords"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_no_new_coords">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_no_new_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_copymo"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_copymo">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_geometry_menu_copymo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;sy&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                              <span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a coord&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;sy c3v &quot;</span><span class="p">,</span> <span class="s2">&quot;ired&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_incompatibility_1"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_incompatibility_1">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_incompatibility_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_geometry_menu_incompatibility_2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_geometry_menu_incompatibility_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_geometry_menu_incompatibility_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_geometry_menu</span><span class="p">(</span><span class="n">new_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_general_menu_wrong_method"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_general_menu_wrong_method">[docs]</a>    <span class="k">def</span> <span class="nf">test_general_menu_wrong_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;wrong method&quot;</span><span class="p">}</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_general_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_general_menu_dft"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_general_menu_dft">[docs]</a>    <span class="k">def</span> <span class="nf">test_general_menu_dft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;DFt&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_general_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_has_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_general_menu_hf"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_general_menu_hf">[docs]</a>    <span class="k">def</span> <span class="nf">test_general_menu_hf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;hf&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_general_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_has_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_general_menu_ccsdt"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_general_menu_ccsdt">[docs]</a>    <span class="k">def</span> <span class="nf">test_general_menu_ccsdt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;ccsdt&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_general_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_has_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_add_atomic_coordinates_from_file_cartesian"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_add_atomic_coordinates_from_file_cartesian">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_atomic_coordinates_from_file_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coord_file&quot;</span><span class="p">:</span> <span class="s2">&quot;another_coord&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_add_atomic_coordinates_from_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a another_coord&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_add_atomic_coordinates_from_file"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_add_atomic_coordinates_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_atomic_coordinates_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_add_atomic_coordinates_from_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;a coord&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_existing_coordinates_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_existing_coordinates_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing_coordinates_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_existing_coordinates</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_existing_coordinates"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_existing_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_existing_coordinates</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_existing_coordinates_no_update"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_existing_coordinates_no_update">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing_coordinates_no_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_existing_coordinates</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_existing_coordinates_cartesian"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_existing_coordinates_cartesian">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing_coordinates_cartesian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_existing_coordinates</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_existing_coordinates_unsupported"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_existing_coordinates_unsupported">[docs]</a>    <span class="k">def</span> <span class="nf">test_existing_coordinates_unsupported</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">UnsupportedDefineStateError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_existing_coordinates</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_define_symmetry"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_define_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">test_define_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sym&quot;</span><span class="p">:</span> <span class="s2">&quot;c2v&quot;</span><span class="p">,</span> <span class="s2">&quot;sym_eps&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_define_symmetry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sy c2v 0.01&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_define_symmetry_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_define_symmetry_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_define_symmetry_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sym&quot;</span><span class="p">:</span> <span class="s2">&quot;wrong_symbol&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_define_symmetry</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_determine_symmetry_eps"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_determine_symmetry_eps">[docs]</a>    <span class="k">def</span> <span class="nf">test_determine_symmetry_eps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;desy_eps&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_determine_symmetry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;desy 0.01&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_determine_symmetry"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_determine_symmetry">[docs]</a>    <span class="k">def</span> <span class="nf">test_determine_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;desy&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;desy_eps&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_determine_symmetry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;desy&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_generate_internal_coordinates"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_generate_internal_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">test_generate_internal_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_generate_internal_coordinates</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ired&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_generate_internal_coordinates_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_generate_internal_coordinates_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_generate_internal_coordinates_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineIredError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_generate_internal_coordinates</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_switch_to_atomic_attribute_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_switch_to_atomic_attribute_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_switch_to_atomic_attribute_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_switch_to_atomic_attribute_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_switch_to_atomic_attribute_menu_internal"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_switch_to_atomic_attribute_menu_internal">[docs]</a>    <span class="k">def</span> <span class="nf">test_switch_to_atomic_attribute_menu_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_switch_to_atomic_attribute_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_switch_to_atomic_attribute_menu_internal_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_switch_to_atomic_attribute_menu_internal_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_switch_to_atomic_attribute_menu_internal_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ired&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineIredError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_switch_to_atomic_attribute_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_skip_atomic_attribute_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_skip_atomic_attribute_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_skip_atomic_attribute_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_skip_atomic_attribute_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_skip_atomic_attribute_menu_internal"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_skip_atomic_attribute_menu_internal">[docs]</a>    <span class="k">def</span> <span class="nf">test_skip_atomic_attribute_menu_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_skip_atomic_attribute_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_skip_atomic_attribute_menu_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_skip_atomic_attribute_menu_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_skip_atomic_attribute_menu_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">UnsupportedDefineStateError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_skip_atomic_attribute_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_basis"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_basis">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_basis</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;def2-SVP&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;all def2-SVP&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_basis_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_basis_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_basis_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_basis</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;wrong basis&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_define_basis_sets"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_define_basis_sets">[docs]</a>    <span class="k">def</span> <span class="nf">test_define_basis_sets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;def2-SVP&quot;</span><span class="p">,</span> <span class="s2">&quot;basis_atom&quot;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;def2-SVP&quot;</span><span class="p">,</span> <span class="s2">&quot;Ca&quot;</span><span class="p">:</span> <span class="s2">&quot;def2-SVP&quot;</span><span class="p">}}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_define_basis_sets</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;all def2-SVP&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;1 def2-SVP&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Ca</span><span class="se">\&quot;</span><span class="s2"> def2-SVP&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_switch_to_molecular_orbital_definition_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_switch_to_molecular_orbital_definition_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_switch_to_molecular_orbital_definition_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_switch_to_molecular_orbital_definition_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_go_to_general_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_go_to_general_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_go_to_general_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_go_to_general_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mo_from_control_file"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mo_from_control_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mo_from_control_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">control_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="n">control_path</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="n">tmp_dir</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mo_from_control_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;use </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">control_path</span><span class="p">)])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mo_from_control_file_2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mo_from_control_file_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mo_from_control_file_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">control_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="n">control_path</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="n">tmp_dir</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mo_from_control_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;use </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">control_path</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mo_from_control_file_longpath"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mo_from_control_file_longpath">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mo_from_control_file_longpath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="p">([</span><span class="s2">&quot;extremelytoolongfilepath&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">makedirs_p</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
            <span class="n">control_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="n">control_path</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="n">dir_path</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mo_from_control_file</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;use </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;tmp_mo/control&quot;</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mo_from_control_file_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mo_from_control_file_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mo_from_control_file_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;usemo&quot;</span><span class="p">:</span> <span class="s2">&quot;/fake/path/to/nothing&quot;</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mo_from_control_file</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_extended_hueckel_theory_menu_nocharge"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_extended_hueckel_theory_menu_nocharge">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_hueckel_theory_menu_nocharge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;unpaired_electrons&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_extended_hueckel_theory_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eht&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_extended_hueckel_theory_menu_charge"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_extended_hueckel_theory_menu_charge">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_hueckel_theory_menu_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;unpaired_electrons&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_extended_hueckel_theory_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eht&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_extended_hueckel_theory_menu_unpaired"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_extended_hueckel_theory_menu_unpaired">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_hueckel_theory_menu_unpaired</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;unpaired_electrons&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_extended_hueckel_theory_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eht&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> <span class="s2">&quot;u 2&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_extended_hueckel_theory_menu_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_extended_hueckel_theory_menu_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_hueckel_theory_menu_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;unpaired_electrons&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_extended_hueckel_theory_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_extended_hueckel_theory_menu_default"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_extended_hueckel_theory_menu_default">[docs]</a>    <span class="k">def</span> <span class="nf">test_extended_hueckel_theory_menu_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;charge&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;unpaired_electrons&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_extended_hueckel_theory_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;eht&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_rpas"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_rpas">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_rpas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;rpas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_urpa_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_urpa_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_urpa_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;dublet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_urpa"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_urpa">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_urpa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_u_off</span><span class="p">,</span> <span class="n">match_ex_response_urpa_on</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;dublet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;urpa&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_polly"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_polly">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_polly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_polly_on</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;polly&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;singlet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;polly&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_wrong_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_wrong_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_wrong_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">match_ex_response_wrong</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;dublet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">UnsupportedDefineStateError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_wrong_ex_method"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_wrong_ex_method">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_wrong_ex_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">return_value</span><span class="o">=</span><span class="n">match_ex_response_st_off</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;wrong&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;singlet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_error_not_activated"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_error_not_activated">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_error_not_activated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_st_off</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_method&quot;</span><span class="p">:</span> <span class="s2">&quot;rpa&quot;</span><span class="p">,</span> <span class="s2">&quot;ex_multi&quot;</span><span class="p">:</span> <span class="s2">&quot;singlet&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_irrep"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_irrep">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_irrep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">,</span> <span class="n">match_ex_state_selection</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="c1"># dr_data.dr.define.match = match_ex_state_selection</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_all_states&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;ex_irrep_states&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span>
        <span class="c1"># use has_calls here since the iteration of the states is done over a dict and the order may not</span>
        <span class="c1"># be assured.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_has_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span>
                                       <span class="p">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;rpas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;a1 7&quot;</span><span class="p">,</span> <span class="s2">&quot;a2 9&quot;</span><span class="p">,</span> <span class="s2">&quot;b1 10&quot;</span><span class="p">,</span> <span class="s2">&quot;b2 10&quot;</span><span class="p">,</span> <span class="s2">&quot;a 10&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_irrep_wrong_sym"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_irrep_wrong_sym">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_irrep_wrong_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">,</span> <span class="n">match_ex_state_selection</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_all_states&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ex_irrep_states&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="s2">&quot;No excited state could be set given the input parameters&quot;</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_excited_state_menu_frequency"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_excited_state_menu_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">test_excited_state_menu_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">se</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_ex_response_st_off</span><span class="p">,</span> <span class="n">match_ex_response_rpas_on</span><span class="p">]</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">define</span><span class="p">)</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">PropertyMock</span><span class="p">(</span><span class="n">side_effect</span><span class="o">=</span><span class="n">se</span><span class="p">)</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ex_frequency&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_excited_state_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ex&quot;</span><span class="p">,</span> <span class="s2">&quot;rpas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;nm&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_ri_state"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_ri_state">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_ri_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rijk&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_ri_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;rijk&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_ri_state_marij"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_ri_state_marij">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_ri_state_marij</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ri&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;marij&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_ri_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ri&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;marij&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_dft_options_use_dft"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_dft_options_use_dft">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_dft_options_use_dft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gridsize&quot;</span><span class="p">:</span> <span class="s2">&quot;m3&quot;</span><span class="p">,</span> <span class="s2">&quot;functional&quot;</span><span class="p">:</span> <span class="s2">&quot;pbe&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_dft_options</span><span class="p">(</span><span class="n">use_dft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;func pbe&quot;</span><span class="p">,</span> <span class="s2">&quot;grid m3&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_dft_options_wrong_xc"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_dft_options_wrong_xc">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_dft_options_wrong_xc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gridsize&quot;</span><span class="p">:</span> <span class="s2">&quot;m3&quot;</span><span class="p">,</span> <span class="s2">&quot;functional&quot;</span><span class="p">:</span> <span class="s2">&quot;pbexxxx&quot;</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_dft_options</span><span class="p">(</span><span class="n">use_dft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_dft_options_no_dft"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_dft_options_no_dft">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_dft_options_no_dft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_dft_options</span><span class="p">(</span><span class="n">use_dft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dft&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mp2_options"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mp2_options">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mp2_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;maxcor&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;ex_mp2&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;use_f12&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_f12*&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mp2_options</span><span class="p">(</span><span class="n">energy_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mp2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;cbas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;ricc2&quot;</span><span class="p">,</span> <span class="s2">&quot;mp2&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;maxiter 200&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mp2_options_geoopt"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mp2_options_geoopt">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mp2_options_geoopt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;maxcor&quot;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;ex_mp2&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;use_f12&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_f12*&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mp2_options</span><span class="p">(</span><span class="n">energy_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;mp2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;cbas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;ricc2&quot;</span><span class="p">,</span> <span class="s2">&quot;geoopt mp2&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;maxiter 200&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mp2_options_mp2"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mp2_options_mp2">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mp2_options_mp2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;maxcor&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ex_mp2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
                                 <span class="s2">&quot;use_f12&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_f12*&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mp2_options</span><span class="p">(</span><span class="n">energy_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;adc(2)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span>
                                   <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;cbas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;exci&quot;</span><span class="p">,</span> <span class="s2">&quot;irrep=a1 multiplicity=10 nexc=1&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;spectrum  states=all&quot;</span><span class="p">,</span> <span class="s2">&quot;exprop  states=all unrelaxed&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;ricc2&quot;</span><span class="p">,</span> <span class="s2">&quot;adc(2)&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mp2_options_mp2_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mp2_options_mp2_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mp2_options_mp2_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>
        <span class="c1"># fail due at ex_mp2</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;maxcor&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ex_mp2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
                                 <span class="s2">&quot;use_f12&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;use_f12*&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mp2_options</span><span class="p">(</span><span class="n">energy_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;adc(2)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_mp2_options_f12"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_mp2_options_f12">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_mp2_options_f12</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Control</span><span class="o">.</span><span class="n">empty</span><span class="p">()</span>
            <span class="n">c</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;maxcor&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ex_mp2&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;use_f12&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;use_f12*&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;maxiter&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;ccsdt&quot;</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_mp2_options</span><span class="p">(</span><span class="n">energy_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;ccsd(t)&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cc&quot;</span><span class="p">,</span> <span class="s2">&quot;freeze&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;cbas&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;f12&quot;</span><span class="p">,</span>
                                                               <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;cabs&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;ricc2&quot;</span><span class="p">,</span> <span class="s2">&quot;ccsd(t)&quot;</span><span class="p">,</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">])</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Control</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">sdgo</span><span class="p">(</span><span class="s2">&quot;rir12&quot;</span><span class="p">,</span> <span class="s2">&quot;ccsdapprox&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;ccsd(f12*)&quot;</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_switch_to_scf_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_switch_to_scf_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_switch_to_scf_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_switch_to_scf_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scf&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_set_scf_options"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_set_scf_options">[docs]</a>    <span class="k">def</span> <span class="nf">test_set_scf_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scfconv&quot;</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="s2">&quot;scfiterlimit&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">expect_mock</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_set_scf_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scf&quot;</span><span class="p">,</span> <span class="s2">&quot;conv&quot;</span><span class="p">,</span> <span class="s2">&quot;0.0001&quot;</span><span class="p">,</span> <span class="s2">&quot;iter&quot;</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_quit_general_menu"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_quit_general_menu">[docs]</a>    <span class="k">def</span> <span class="nf">test_quit_general_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">):</span>

        <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_quit_general_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assert_sendline_calls</span><span class="p">(</span><span class="n">dr_data</span><span class="o">.</span><span class="n">sendline_mock</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_copy_mo_files_mo"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_copy_mo_files_mo">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_copy_mo_files_mo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;mos&quot;</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;mos&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_copy_mo_files_alpha_beta"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_copy_mo_files_alpha_beta">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;alpha_beta_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_copy_mo_files_alpha_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;mos&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_copy_mo_files_ab_mos"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_copy_mo_files_ab_mos">[docs]</a>    <span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;dir_name&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;mos_nh3&#39;</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">test_copy_mo_files_ab_mos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">mo_dirpath</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="n">mo_dirpath</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span>
            <span class="n">touch_file</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">)</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;mos&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_copy_mo_files_error"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_copy_mo_files_error">[docs]</a>    <span class="k">def</span> <span class="nf">test_copy_mo_files_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;copymo&quot;</span><span class="p">:</span> <span class="s2">&quot;fake_path&quot;</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">tmp_dir</span>
            <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DefineParameterError</span><span class="p">):</span>
                <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_copy_mo_files</span><span class="p">()</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_add_cosmo"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_add_cosmo">[docs]</a>    <span class="k">def</span> <span class="nf">test_add_cosmo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;$end&quot;</span><span class="p">)</span>

            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;nppa&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;nspa&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;disex&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;rsolv&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                                     <span class="s2">&quot;routf&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;cavity&quot;</span><span class="p">:</span> <span class="s2">&quot;closed&quot;</span><span class="p">}</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_add_cosmo</span><span class="p">()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">assert</span> <span class="s2">&quot;epsilon&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;nppa&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;disex&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;rsolv&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;routf&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;cavity&quot;</span> <span class="ow">in</span> <span class="n">s</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_dump_command_file"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_dump_command_file">[docs]</a>    <span class="k">def</span> <span class="nf">test_dump_command_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">DefineRunner</span><span class="p">({})</span>
        <span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;dscf&#39;</span><span class="p">,</span> <span class="s1">&#39;a coord&#39;</span><span class="p">,</span> <span class="s1">&#39;desy&#39;</span><span class="p">,</span> <span class="s1">&#39;ired&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;all def-SV(P)&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;eht&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;dft&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">,</span> <span class="s1">&#39;func b-p&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;scf&#39;</span><span class="p">,</span> <span class="s1">&#39;iter&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr</span><span class="o">.</span><span class="n">dump_command_file</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;test_file&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;test_file&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">commands</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>

            <span class="k">assert</span> <span class="n">dr</span><span class="o">.</span><span class="n">sent_commands</span> <span class="o">==</span> <span class="n">commands</span></div>

<div class="viewcode-block" id="TestDefineRunner.test_postprocess"><a class="viewcode-back" href="../../../../api/turbomoleio.input.tests.html#turbomoleio.input.tests.test_define.TestDefineRunner.test_postprocess">[docs]</a>    <span class="k">def</span> <span class="nf">test_postprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dr_data</span><span class="p">,</span> <span class="n">delete_tmp_dir</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">temp_dir</span><span class="p">(</span><span class="n">delete_tmp_dir</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmp_dir</span><span class="p">:</span>
            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;disp&quot;</span><span class="p">:</span> <span class="s2">&quot;DFT-D3&quot;</span><span class="p">,</span> <span class="s2">&quot;use_cosmo&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;$end&quot;</span><span class="p">)</span>

            <span class="n">dr_data</span><span class="o">.</span><span class="n">dr</span><span class="o">.</span><span class="n">_postprocess</span><span class="p">()</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">assert</span> <span class="s2">&quot;disp3&quot;</span> <span class="ow">in</span> <span class="n">s</span>
            <span class="k">assert</span> <span class="s2">&quot;cosmo&quot;</span> <span class="ow">in</span> <span class="n">s</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021 BASF SE, Matgenix SRL.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>